<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ke Ao Teensy Flight Software: Start Here</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ke Ao Teensy Flight Software
   </div>
   <div id="projectbrief">The software on the Teensy in the Ke Ao cubesat.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Start Here </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>This is the documentation on the Flight Software (FSW) that runs on the Teensy microcontroller in the Ke Ao CubeSat's On-Board Computer (OBC) board. This page is designed to give a high- level understanding of the FSW and introduce essential computing concepts that the FSW uses.</p>
<h1><a class="anchor" id="Teensy"></a>
The Teensy</h1>
<p>This code runs on the <a class="el" href="">Teensy 4.1 microcontroller. </a> As the link shows, this is a very capable microcontroller. If you are familiar with <a class="el" href="">Arduino, </a> the Teensy is very similar. You can think of the Teensy as a souped-up Arduino, with more ports and processing power.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000034">Todo:</a></b></dt><dd>Create a DE setup guide and link to it.</dd></dl>
<p>There are many ways to program a Teensy. This project uses the PlatformIO IDE within Visual Studio Code. This allows us to use a more powerful IDE than Arduino IDE (which is still great for prototyping!). Make sure you follow the instructions in the Development Environment Setup Guide in order to program the Teensy.</p>
<h1><a class="anchor" id="HighLevel"></a>
A High-Level Understanding of the FSW</h1>
<p>This section will give an overview of the FSW, how it works, and its functional components.</p>
<p>The Teensy, as mentioned earlier, is essentially a powerful Arduino. The FSW is built on the Arduino's programming principles. That is, there is a <code><a class="el" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Initialization code.">setup()</a></code> function that is called once, followed by a <code><a class="el" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Operating code.">loop()</a></code> function that runs in an infinite loop, forever. These links are to the functions in the <a class="el" href="main_8cpp.html" title="The main operating loop for the Teensy.">main.cpp</a> file, and are the starting point for the code. In essence, this is the top-level Arduino code, the same as any other Arduino sketch.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000035">Todo:</a></b></dt><dd>Create an explaination of Teensy multithreading.</dd></dl>
<p>It could be possible to put all our code into this one file, but this would be a massive file that would be hard to read and maintain. In addition, we want to be able to seperate the code based on what components of the CubeSat it effects.</p>
<p>As a result, we split up the codebase and execution using multithreading. Each thread (we call them channels in our implementation) is responsible for some component of the CubeSat, such as the radios, sensors, or PDU. A brief description of each channel is given below.</p>
<ul>
<li>main_channel: Technically, this channel is not listed in the code. That is because this is the first channel that is started when the Teensy is first powered on. Even though it is not explicitly defined, the Teensy switches to it like any other channel and executes its code. It does the following:<ul>
<li>It acts as a "router" for PacketComm packets. Incoming packets are sent to the <a class="el" href="artemis__defs_8h.html#ae77a939baa88784acde567432857faac">main_queue</a>, which then are sent to the appropriate channel for handling.</li>
<li>It polls the built-in sensors that are not handled by a channel (such as the temperature, current, and IMU sensors) for their readings.</li>
<li>It generates PacketComm packets for testing other channels.</li>
<li>It creates every other channel and allocates computing time to them.</li>
</ul>
</li>
<li><a class="el" href="artemis__channels_8h.html#a95d12743fdb105b158bf9fa94e8a9f3a">astrodev_channel(): </a> Controls the Astrodev (Lithium-3) radio. It does the following:<ul>
<li>It configures and connects to the Astrodev radio.</li>
<li>It handles incoming transmissions containing PacketComm packets, and adds those packets to the <a class="el" href="artemis__defs_8h.html#ae77a939baa88784acde567432857faac">main_queue</a>.</li>
<li>It transmits outgoing PacketComm packets from its <a class="el" href="artemis__defs_8h.html#af84bb624ddc22f5e1c52dce692eb72b5">astrodev_queue</a>.</li>
</ul>
</li>
<li><a class="el" href="artemis__channels_8h.html#aead4a5fada74759d051352b3c244e50c">rfm23_channel(): </a> Controls the HopeRF RFM23 radio. It does the following:<ul>
<li>It configures and connects to the RFM23 radio.</li>
<li>It handles incoming transmissions containing PacketComm packets, and adds those packets to the <a class="el" href="artemis__defs_8h.html#ae77a939baa88784acde567432857faac">main_queue</a>.</li>
<li>It transmits outgoing PacketComm packets from its <a class="el" href="artemis__defs_8h.html#aba61200a48a4acd00dc3dcc14c32ee09">rfm23_queue</a>.</li>
</ul>
</li>
<li><a class="el" href="artemis__channels_8h.html#a841ed7716280f8206542a4c755e76ead">rfm98_channel(): </a> Controls the HopeRF RFM98 LoRa radio. It does the following:<ul>
<li>It configures and connects to the RFM98 radio.</li>
<li>It handles incoming transmissions containing PacketComm packets, and adds those packets to the <a class="el" href="artemis__defs_8h.html#ae77a939baa88784acde567432857faac">main_queue</a>.</li>
<li>It transmits outgoing PacketComm packets from its <a class="el" href="artemis__defs_8h.html#a6de4a2d03fcc47b4700ee43a08c755ed">rfm98_queue</a>.</li>
</ul>
</li>
<li><a class="el" href="artemis__channels_8h.html#ae9687387e45dcd89d44f9048d5feb4d0">pdu_channel(): </a> Controls Ke Ao's Power Distribution Unit (PDU). It does the following:<ul>
<li>It connects to the PDU's built-in microcontroller.</li>
<li>It gets switch states on the PDU.</li>
<li>It sets switch states on the PDU.</li>
</ul>
</li>
<li><a class="el" href="artemis__channels_8h.html#ae528021d5dead3e3215dc5ef4eed93a7">rpi_channel(): </a> Communicates with the Raspberry Pi (RPi) on Ke Ao's OBC.<ul>
<li>It connects to the RPi.</li>
<li>It sends Astrodev packets to the RPi.</li>
<li>It receives Astrodev packets from the RPi.</li>
<li>It can command the RPi to power down.</li>
</ul>
</li>
</ul>
<p>As the descriptions show, each channel runs independently, sharing information in the form of PacketComm packets inserted into each others' queues. At a high level, the Teensy flips through these channels quickly, executing a little bit of each channel before moving on to the next channel. The code must therefore be written with the assumption that it may be interrupted at any time. Further information is given in the multithreading section. <br  />
</p>
<h1><a class="anchor" id="BuildFlags"></a>
PlatformIO Build Flags</h1>
<p>This section describes the PlatformIO build flags and their uses.</p>
<p>We can take advantage of the build flags feature of PlatformIO to selectively compile the code for testing and debugging. The build flags are found in the platformio.ini file in the root directory of the code. They are listed on individual lines, like so: </p><pre class="fragment">build_flags = 
    -D COSMOS_MICRO_COSMOS
    -D TEST_PACKETS
    -D DEBUG_PRINT
;   -D DEBUG_PRINT_TIMEOUT
;   -D DEBUG_PRINT_HEXDUMP</pre><p>The <code>;</code> symbol comments out a flag, disabling it.</p>
<h2><a class="anchor" id="Tests"></a>
Tests</h2>
<p>These flags are used to run test code, generating test data to see how the program handles incoming data.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Flag Name   </th><th class="markdownTableHeadNone">Function    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TEST_PACKETS   </td><td class="markdownTableBodyNone">Enable to generate test PacketComm packets as defined in <a class="el" href="packet__tests_8h.html">packet_tests.h</a>.   </td></tr>
</table>
<h2><a class="anchor" id="DebugFlags"></a>
Debug Flags</h2>
<p>If you've used Arduino before, you might be familiar with the <code>Serial.print()</code> style of debugging. We use the same method of debugging in this project for simplicity. When enabled, the Teensy will print debug statements over the Serial connection established over USB to the Terminal in VSCode.</p>
<p>Multiple flags are available for use, depending on what statements you'd like to print. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Flag Name   </th><th class="markdownTableHeadNone">Function    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DEBUG_PRINT   </td><td class="markdownTableBodyNone">Enable to print debug messages to the Terminal.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DEBUG_PRINT_TIMEOUT   </td><td class="markdownTableBodyNone">Enable to print messages that the Astrodev radio has been polled for data but does not reply before timeout.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DEBUG_PRINT_HEXDUMP   </td><td class="markdownTableBodyNone">Enable to print hexdumps of Astrodev packets to serial console.   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
