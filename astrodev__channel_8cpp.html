<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ke Ao Teensy Flight Software: teensy_fsw/src/channels/astrodev_channel.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ke Ao Teensy Flight Software
   </div>
   <div id="projectbrief">The software on the Teensy in the Ke Ao cubesat.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('astrodev__channel_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">astrodev_channel.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>The channel controlling the Astrodev (Li-3) radio.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="artemis__channels_8h_source.html">channels/artemis_channels.h</a>&quot;</code><br />
<code>#include &lt;deque&gt;</code><br />
<code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;<a class="el" href="astrodev_8h_source.html">astrodev.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6f18de62b6be40ffaf8b3d5613e78f85"><td class="memItemLeft" align="right" valign="top"><a id="a6f18de62b6be40ffaf8b3d5613e78f85" name="a6f18de62b6be40ffaf8b3d5613e78f85"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ASTRODEV_BAUD</b>&#160;&#160;&#160;9600</td></tr>
<tr class="memdesc:a6f18de62b6be40ffaf8b3d5613e78f85"><td class="mdescLeft">&#160;</td><td class="mdescRight">The baud rate of the serial connection to the radio. <br /></td></tr>
<tr class="separator:a6f18de62b6be40ffaf8b3d5613e78f85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14e037e365cc3a248e56d15d0e228927"><td class="memItemLeft" align="right" valign="top"><a id="a14e037e365cc3a248e56d15d0e228927" name="a14e037e365cc3a248e56d15d0e228927"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ASTRODEV_FREQ</b>&#160;&#160;&#160;435000</td></tr>
<tr class="memdesc:a14e037e365cc3a248e56d15d0e228927"><td class="mdescLeft">&#160;</td><td class="mdescRight">The operating frequency of the Astrodev radio in kHz. <br /></td></tr>
<tr class="separator:a14e037e365cc3a248e56d15d0e228927"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7a9d386221505319d175787f82700a25"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="astrodev__channel_8cpp.html#a7a9d386221505319d175787f82700a25">astrodev_init</a> (HardwareSerial *new_serial, uint32_t baud_rate)</td></tr>
<tr class="memdesc:a7a9d386221505319d175787f82700a25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to initialize Astrodev radio.  <br /></td></tr>
<tr class="separator:a7a9d386221505319d175787f82700a25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78d39ad523f766232bc734d4b5654d6b"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="astrodev__channel_8cpp.html#a78d39ad523f766232bc734d4b5654d6b">astrodev_recv</a> ()</td></tr>
<tr class="memdesc:a78d39ad523f766232bc734d4b5654d6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to receive Astrodev frames from the Astrodev radio.  <br /></td></tr>
<tr class="separator:a78d39ad523f766232bc734d4b5654d6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77301255c9f9d4c5f161652d001227d0"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="astrodev__channel_8cpp.html#a77301255c9f9d4c5f161652d001227d0">astrodev_send</a> ()</td></tr>
<tr class="memdesc:a77301255c9f9d4c5f161652d001227d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to send PacketComm packets through the Astrodev radio.  <br /></td></tr>
<tr class="separator:a77301255c9f9d4c5f161652d001227d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The channel controlling the Astrodev (Li-3) radio. </p>
<p>This is the channel that controls the Astrodev (Li-3) radio, in parallel to all other channels. When it gets a slice of computing time on the Teensy's processor, it performs actions related to the Astrodev radio. This channel must be written such that it can be interrupted at any time to switch to the next channel.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000032">Todo:</a></b></dt><dd><p class="startdd">Test astrodev channel without astrodev threads </p>
<p class="enddd">See if we need individual threads for sending/receiving </p>
</dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7a9d386221505319d175787f82700a25" name="a7a9d386221505319d175787f82700a25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a9d386221505319d175787f82700a25">&#9670;&#160;</a></span>astrodev_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t astrodev_init </td>
          <td>(</td>
          <td class="paramtype">HardwareSerial *&#160;</td>
          <td class="paramname"><em>new_serial</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>baud_rate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to initialize Astrodev radio. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_serial</td><td>Pointer to a HardwareSerial object representing a serial port on the Teensy. </td></tr>
    <tr><td class="paramname">baud_rate</td><td>The baud rate at which to communicate with the Astrodev radio. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int32_t Returns 0 if successful, -1 if unsuccessful due to checks in this function. May return other negative numbers, indicating error in called functions. </dd></dl>
<p>The Astrodev radio is initialized with the passed-in serial port and baud rate.</p>
<p>The Teensy connects to the Astrodev radio over the initialized serial connection. This connection generates no-op and reset Astrodev frames. If these frames are unacknowledged or replied to with a no-ack, the initialization of the Astrodev radio has failed.</p>
<p>The internal Astrodev radio object is configured using pre-defined values.</p>
<p>The configuration settings of the internal Astrodev radio object are applied to the actual Astrodev radio. If the configuration is not sucessfully applied, return with an error code.</p>
<p>The transceiver configuration settings of the actual Astrodev radio are verified by polling the radio. If the Astrodev radio transceiver configuration request cannot be sent, return with an error code. If the request was sent but the settings do not match the internal Astrodev radio object, return -1.</p>

</div>
</div>
<a id="a78d39ad523f766232bc734d4b5654d6b" name="a78d39ad523f766232bc734d4b5654d6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78d39ad523f766232bc734d4b5654d6b">&#9670;&#160;</a></span>astrodev_recv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t astrodev_recv </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to receive Astrodev frames from the Astrodev radio. </p>
<dl class="section return"><dt>Returns</dt><dd>int32_t Returns Astrodev frame payload size in bytes. This value is 0 if the frame is an ack-type header-only reply frame. Returns -1 if received frame is of a command type that is not handled. May return other negative values, indicating error in called functions. </dd></dl>
<p>The radio is commanded to receive an Astrodev frame. If a frame is received, check its header for its command type. Handle the frame based on this type. See the code for a detailed explaination.</p>

</div>
</div>
<a id="a77301255c9f9d4c5f161652d001227d0" name="a77301255c9f9d4c5f161652d001227d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77301255c9f9d4c5f161652d001227d0">&#9670;&#160;</a></span>astrodev_send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t astrodev_send </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to send PacketComm packets through the Astrodev radio. </p>
<dl class="section return"><dt>Returns</dt><dd>int32_t Returns Astrodev frame payload size in bytes. This value includes the Astrodev header, payload (which is the entire PacketComm packet), and Astrodev checksum. Returns -1 if unsucessful. May return other negative values, indicating error in called functions. </dd></dl>
<p>The radio is commanded to transmit the internally-defined outgoing packet if the buffer is not full. If the buffer is full, the Teensy waits for a short while before pinging the radio to clear the buffer_full flag and trying again. If the buffer remains full after three tries, return with an error code.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d3431abf3635df4ecc3460510eb8d42d.html">teensy_fsw</a></li><li class="navelem"><a class="el" href="dir_743e2551979b98a09a056e2f9873d78e.html">src</a></li><li class="navelem"><a class="el" href="dir_e5f081f33169210e043d0b2a3f7c2f5c.html">channels</a></li><li class="navelem"><a class="el" href="astrodev__channel_8cpp.html">astrodev_channel.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
